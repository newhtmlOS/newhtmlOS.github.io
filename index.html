<!doctype html>
<html lang="pt-BR" data-theme="dark">
<head>
  <link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b1220">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js').catch(console.error);
  });
}
</script>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1"/>
<title>x1coOS ‚Äî v7 (Assistente com parser matem√°tico avan√ßado)</title>
<meta name="theme-color" content="#0b1220" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#eef2f8" media="(prefers-color-scheme: light)">
<style>
:root{
  --bg:#0b1220; --panel:#0f1724; --accent:#22d3ee; --accent2:#60a5fa;
  --text:#e6eef8; --muted:#9fb1c9;
  --glass: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  --stroke: rgba(255,255,255,0.10); --hover: rgba(255,255,255,0.06);
  --shadow: 0 12px 30px rgba(0,0,0,.45);
  --radius: 16px;
  --safe-b: env(safe-area-inset-bottom, 0px);
  --safe-t: env(safe-area-inset-top, 0px);
  --sys-h: 64px;
}
:root[data-theme="light"]{
  --bg:#eef2f8; --panel:#ffffff; --accent:#0ea5e9; --accent2:#6366f1;
  --text:#0f172a; --muted:#475569; --stroke: rgba(0,0,0,0.10); --hover: rgba(0,0,0,0.05);
  --shadow: 0 12px 30px rgba(0,0,0,.12);
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;padding:0;overflow:hidden;background:linear-gradient(180deg,#071026 0%, #09172a 50%, #071222 100%)}
:root[data-theme="light"] body{background:linear-gradient(180deg,#f4f7fb 0%, #eef2f8 50%, #e8edf6 100%)}
body{color:var(--text);font:14px/1.35 Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial}
@media (prefers-reduced-motion:no-preference){
  *{transition:background-color .25s,color .25s,border-color .25s,opacity .2s,transform .12s}
}

#root{position:relative;width:100vw;height:100dvh;min-height:100svh;display:flex;flex-direction:column;overflow:hidden}
.desktop{flex:1;display:flex;flex-direction:column;overflow:hidden}
.wallpaper{flex:1;padding:18px 18px 0;display:flex;flex-direction:column;gap:14px;overflow:auto;
  background:
    radial-gradient(1200px 600px at -10% -20%, color-mix(in oklab, var(--accent) 22%, transparent) 0%, transparent 60%),
    radial-gradient(900px 600px at 120% 120%, color-mix(in oklab, var(--accent2) 18%, transparent) 0%, transparent 60%);
}
.homeActions{display:flex;gap:10px;align-self:flex-end}
.fsBtn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;
  background:var(--panel);border:1px solid var(--stroke);cursor:pointer;color:var(--text);box-shadow:var(--shadow);user-select:none}
.fsBtn:hover{background:var(--hover)}
.fsBtn svg{width:18px;height:18px}

.grid{display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(98px, 1fr));}
.appIcon{background:var(--glass); border:1px solid var(--stroke); border-radius:18px; padding:12px;
  box-shadow: var(--shadow); cursor:pointer; user-select:none; display:flex; flex-direction:column; align-items:center; gap:10px;}
.appIcon:hover{background:var(--hover); transform:translateY(-1px)}
.appIcon svg{width:38px;height:38px}
.appIcon .label{font-size:12px;color:var(--muted);text-align:center}

.taskbar{display:flex; align-items:center; gap:10px;height:54px; padding:8px 10px;
  background:linear-gradient(0deg, rgba(0,0,0,0.35), rgba(255,255,255,0.02)); backdrop-filter: blur(8px); border-top:1px solid var(--stroke)}
.start{width:38px;height:38px;border-radius:12px;background:var(--panel);border:1px solid var(--stroke);display:flex;align-items:center;justify-content:center;cursor:pointer}
.tasks{display:flex;gap:6px;align-items:center;flex:1;overflow:auto}
.taskBtn{border:1px solid var(--stroke);background:var(--panel);color:var(--text);padding:8px 12px;border-radius:12px;white-space:nowrap}
.clock{min-width:84px;text-align:right;color:var(--muted);font-variant-numeric:tabular-nums}

.startMenu{position:absolute;left:12px;right:12px;bottom:64px;background:var(--panel);border:1px solid var(--stroke);border-radius:18px;box-shadow:var(--shadow);padding:12px;display:none;z-index:30}
.startMenu.visible{display:block}
.startMenu .row{display:flex;gap:8px;flex-wrap:wrap}
.startMenu button{border:1px solid var(--stroke);background:var(--glass);color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}

.window{position:absolute; left:64px; top:64px; width:780px; height:520px;background:var(--glass); border:1px solid var(--stroke); border-radius:16px; box-shadow: var(--shadow); display:flex; flex-direction:column; overflow:hidden}
.titlebar{height:44px; display:flex; align-items:center; gap:8px; padding:0 10px; background:linear-gradient(180deg, rgba(255,255,255,0.03), transparent)}
.title{flex:1; font-weight:700}
.controls{display:flex; gap:6px}
.ctrl{width:28px;height:28px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer}
.ctrl:hover{background:var(--hover)}
.content{flex:1; overflow:auto; padding:12px; background:linear-gradient(180deg, rgba(255,255,255,0.006), transparent)}

@media (max-width: 900px){
  .taskbar.hideOnMobile{display:none !important}
  .window.mobile-full{position:fixed; inset:0; width:100vw; height:100dvh; border-radius:0; left:0 !important; top:0 !important; border:none}
  .window.mobile-full .titlebar{display:none}
  .window.mobile-full .content{padding:10px; padding-bottom:calc(var(--sys-h) + var(--safe-b) + 10px)}
}

.systemBar{position:fixed; left:0; right:0; bottom:0; height:calc(var(--sys-h) + var(--safe-b));
  padding:8px 16px calc(8px + var(--safe-b)); background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.45)); backdrop-filter: blur(10px);
  border-top:1px solid var(--stroke); display:none; align-items:center; justify-content:center; gap:28px; z-index:40}
.systemBar.visible{display:flex}
.sysBtn{width:46px;height:46px;border-radius:999px;border:1px solid var(--stroke); background:var(--panel);color:var(--text);display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--shadow)}
.sysHome{width:86px;border-radius:999px}
.sysIcon{width:22px;height:22px}

.camView{width:100%; aspect-ratio:16/9; background:#000; border-radius:14px}
.toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px}
.button{border:1px solid var(--stroke); background:var(--panel); color:var(--text); padding:9px 12px; border-radius:12px; cursor:pointer; font-weight:700}
.button:hover{background:var(--hover)}
.preview{max-width:100%; display:none; border-radius:14px; margin-top:10px}
.hint{color:var(--muted); font-size:12px}
.switch{display:inline-flex; align-items:center; gap:10px}
.switch input{appearance:none;width:50px;height:28px;border-radius:28px;background:#9aa2b1;position:relative;outline:none;transition:background .2s}
.switch input:checked{background:var(--accent)}
.switch input::after{content:""; position:absolute; top:3px; left:3px; width:22px; height:22px; border-radius:50%; background:#fff; transition:left .2s}
.switch input:checked::after{ left:25px }
.toast{position:fixed; left:50%; transform:translateX(-50%); bottom:calc(var(--sys-h) + var(--safe-b) + 20px); background:var(--panel); border:1px solid var(--stroke); padding:10px 12px; border-radius:12px; box-shadow:var(--shadow); z-index:50; font-size:13px}

.chat{display:flex; flex-direction:column; gap:10px; height:100%}
.chatLog{flex:1; overflow:auto; background:rgba(0,0,0,0.25); border:1px solid var(--stroke); border-radius:12px; padding:10px}
.msg{display:flex; gap:8px; margin:6px 0}
.msg.me{justify-content:flex-end}
.bubble{max-width:80%; padding:10px 12px; border-radius:14px}
.me .bubble{background:var(--accent2); color:white; border-top-right-radius:6px}
.ai .bubble{background:var(--panel); border:1px solid var(--stroke); border-top-left-radius:6px}
.chatInput{display:flex; gap:8px}
.chatInput input{flex:1; padding:10px; border-radius:12px; border:1px solid var(--stroke); background:transparent; color:inherit}
</style>

<!-- x1coOS: Glass/Blur Kit v1 -->
<style id="x1coos-glass-v1">
:root{
  --glass-bg: rgba(15,23,42,0.35);
  --glass-brd: rgba(148,163,184,0.22);
  --glass-blur: 14px;
  --glass-sat: 1.15;
}
/* Componente gen√©rico */
.glass {
  background: var(--glass-bg) !important;
  border: 1px solid var(--glass-brd) !important;
  -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
  backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat)) !important;
  box-shadow: 0 12px 30px rgba(0,0,0,.35);
}

/* Aplica√ß√£o sem alterar o HTML original ‚Äî apenas por seletor */
.window,
.startMenu,
.taskbar,
#systemBar {
  -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat));
  backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-sat));
  background: var(--glass-bg);
  border-color: var(--glass-brd);
}

/* T√≠tulo e √°reas internas mant√™m vidro leve */
.titlebar {
  -webkit-backdrop-filter: blur(10px) saturate(1.1);
  backdrop-filter: blur(10px) saturate(1.1);
}

/* Fallback para navegadores sem suporte */
@supports not ((backdrop-filter: blur(10px)) or (-webkit-backdrop-filter: blur(10px))) {
  .glass,
  .window,
  .startMenu,
  .taskbar,
  #systemBar { background: rgba(30,41,59,0.75) !important; }
}
</style>
</head>
<body>
<div id="root">
  <div class="desktop" id="desktop">
    <div class="wallpaper">
      <div class="homeActions">
        <button id="homeFullscreen" class="fsBtn" title="Tela cheia do sistema" aria-label="Tela cheia">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H3v5M16 3h5v5M21 16v5h-5M3 16v5h5"/></svg>
          <span id="fsLabel">Tela cheia</span>
        </button>
      </div>
      <div class="grid" id="iconGrid">
        <div class="appIcon" data-app="assistant"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="9" opacity=".2"/><path d="M8 12h8M12 8v8"/></svg><div class="label">Assistente</div></div>
        <div class="appIcon" data-app="terminal" style="visibility:hidden;pointer-events:none"<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 5h18v14H3z" opacity=".2"/><path d="M7 9l3 3-3 3M12 15h5"/></svg><div class="label">Terminal</div></div>
        <div class="appIcon" data-app="notes"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 3h9l3 3v15H6z" opacity=".2"/><path d="M15 3v4h4M8 10h8M8 14h8M8 18h6"/></svg><div class="label">Notas</div></div>
        <div class="appIcon" data-app="settings"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 8a4 4 0 100 8 4 4 0 000-8z"/><path d="M4 12h2M18 12h2M12 4v2M12 18v2M5.6 5.6l1.4 1.4M16.9 16.9l1.4 1.4M5.6 18.4l1.4-1.4M16.9 7.1l1.4-1.4" opacity=".6"/></svg><div class="label">Config</div></div>
        <div class="appIcon" data-app="camera"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="6" width="18" height="12" rx="3" opacity=".2"/><path d="M9 6l2-2h2l2 2"/><circle cx="12" cy="12" r="4"/></svg><div class="label">C√¢mera</div></div>
      </div>
    </div>
    <div class="taskbar" id="taskbar">
      <div class="start" id="btnStart" title="Iniciar">‚ò∞</div>
      <div class="tasks" id="tasks"></div>
      <div class="clock" id="clock">--:--</div>
    </div>
    <div class="startMenu" id="startMenu">
      <div class="row">
        <button data-app="assistant">Assistente</button>
        <button data-app="notes">Notas</button>
        <button data-app="camera">C√¢mera</button>
        <button data-app="settings">Config</button>
      </div>
    </div>
  </div>

  <div class="systemBar" id="systemBar" aria-label="Barra do sistema">
    <button class="sysBtn" id="btnBack" title="Voltar" aria-label="Voltar">
      <svg class="sysIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    <button class="sysBtn sysHome" id="btnHome" title="Home" aria-label="Home">
      <svg class="sysIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l9-9 9 9"/><path d="M9 21V9h6v12"/></svg>
    </button>
    <button class="sysBtn" id="btnRecents" title="Tarefas" aria-label="Tarefas">
      <svg class="sysIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="4" y="4" width="7" height="7"/><rect x="13" y="4" width="7" height="7"/>
        <rect x="4" y="13" width="7" height="7"/><rect x="13" y="13" width="7" height="7"/>
      </svg>
    </button>
  </div>
</div>

<template id="winTpl">
  <div class="window" data-id="">
    <div class="titlebar">
      <div class="title">Janela</div>
      <div class="controls">
        <div class="ctrl" data-act="min">‚Äî</div>
        <div class="ctrl" data-act="max">‚ñ°</div>
        <div class="ctrl" data-act="close">‚úï</div>
      </div>
    </div>
    <div class="content"></div>
  </div>
</template>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const winTpl = document.getElementById('winTpl');
  const tasks = document.getElementById('tasks');
  const startMenu = document.getElementById('startMenu');
  const btnStart = document.getElementById('btnStart');
  const iconGrid = document.getElementById('iconGrid');
  const clock = document.getElementById('clock');
  const systemBar = document.getElementById('systemBar');
  const taskbar = document.getElementById('taskbar');
  const bBack = document.getElementById('btnBack');
  const bHome = document.getElementById('btnHome');
  const bRecents = document.getElementById('btnRecents');
  const homeFS = document.getElementById('homeFullscreen');
  const fsLabel = document.getElementById('fsLabel');
  let z = 10, idc = 1;
  const THEME_KEY = 'htmlos-theme';
  const isMobile = () => window.matchMedia('(max-width: 900px)').matches;

  (function applyTheme(){
    const saved = localStorage.getItem(THEME_KEY);
    const theme = (saved==='light'||saved==='dark')?saved:'dark';
    document.documentElement.setAttribute('data-theme', theme);
  })();

  function now(){ const d = new Date(); return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}); }
  clock.textContent = now(); setInterval(()=> clock.textContent = now(), 1000);

  function fsActive(){ return !!(document.fullscreenElement || document.webkitFullscreenElement); }
  async function enterFullscreen(){
    const el = document.documentElement;
    try{
      if(el.requestFullscreen) await el.requestFullscreen();
      else if(el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
      fsLabel.textContent = 'Sair de tela cheia';
    }catch(e){
      alert('Seu navegador pode bloquear tela cheia aqui. Em iOS, instale como app (PWA) para melhor efeito.');
    }
  }
  async function exitFullscreen(){
    try{
      if(document.fullscreenElement && document.exitFullscreen) await document.exitFullscreen();
      else if(document.webkitFullscreenElement && document.webkitExitFullscreen) await document.webkitExitFullscreen();
      fsLabel.textContent = 'Tela cheia';
    }catch(e){}
  }
  function syncFsLabel(){ fsLabel.textContent = fsActive() ? 'Sair de tela cheia' : 'Tela cheia'; }
  document.addEventListener('fullscreenchange', syncFsLabel);
  document.addEventListener('webkitfullscreenchange', syncFsLabel);
  homeFS.addEventListener('click', ()=>{ fsActive() ? exitFullscreen() : enterFullscreen(); });

  function addTask(id, title){
    const b = document.createElement('button'); b.className='taskBtn'; b.textContent=title; b.dataset.win=id;
    tasks.appendChild(b); b.addEventListener('click', ()=> focusWin(id));
  }
  function rmTask(id){ const b = tasks.querySelector(`[data-win="${id}"]`); if(b) b.remove(); }
  function focusWin(id){ const w = document.querySelector(`.window[data-id="${id}"]`); if(!w) return; w.style.zIndex = ++z; w.style.display='flex'; }

  function makeDrag(win){
    const bar = win.querySelector('.titlebar');
    let dx=0,dy=0,sx=0,sy=0,drag=false;
    function start(e){
      if(isMobile()) return;
      drag=true; const p=e.touches?e.touches[0]:e; dx=p.clientX; dy=p.clientY;
      sx=parseInt(win.style.left||0); sy=parseInt(win.style.top||0); win.style.zIndex=++z;
    }
    function move(e){
      if(!drag) return; const p=e.touches?e.touches[0]:e;
      win.style.left = Math.max(8, Math.min(window.innerWidth-120, sx + (p.clientX-dx)))+'px';
      win.style.top  = Math.max(8, Math.min(window.innerHeight-100, sy + (p.clientY-dy)))+'px';
    }
    function end(){ drag=false; }
    bar.addEventListener('mousedown', start); document.addEventListener('mousemove', move); document.addEventListener('mouseup', end);
    bar.addEventListener('touchstart', start, {passive:false}); document.addEventListener('touchmove', move, {passive:false}); document.addEventListener('touchend', end);
  }

  function openApp(name){
    const win = winTpl.content.cloneNode(true).querySelector('.window');
    const id = 'w'+(idc++); win.dataset.id=id;
    const content = win.querySelector('.content');
    const title = win.querySelector('.title');

    win.style.left = (60+Math.random()*180)+'px';
    win.style.top = (60+Math.random()*120)+'px';

    document.getElementById('desktop').appendChild(win);
    addTask(id, name[0].toUpperCase()+name.slice(1));
    makeDrag(win);
    focusWin(id);

    if(isMobile()){
      win.classList.add('mobile-full');
      systemBar.classList.add('visible');
      taskbar.classList.add('hideOnMobile');
      win.style.left = '0px';
      win.style.top = '0px';
      win.style.width = '100vw';
      win.style.height = '100dvh';
    }

    win.querySelector('[data-act="close"]').addEventListener('click', ()=>{
      win.remove(); rmTask(id);
      if(isMobile() && document.querySelectorAll('.window').length===0){
        systemBar.classList.remove('visible');
        taskbar.classList.remove('hideOnMobile');
      }
    });
    win.querySelector('[data-act="min"]').addEventListener('click', ()=>{ win.style.display='none'; });
    win.querySelector('[data-act="max"]').addEventListener('click', ()=>{ if(!isMobile()) toggleMaxDesktop(win); });

    if(name==='assistant'){
      title.textContent='Assistente';
      buildAssistant(content);
    }
    if(name==='terminal'){
      title.textContent='Terminal';
      content.innerHTML = `
        <div class="hint" style="margin-bottom:6px"><strong>x1coOS Terminal</strong> ‚Äî digite <code>help</code></div>
        <pre id="out" style="background:#071320;border-radius:12px;padding:10px;min-height:220px;white-space:pre-wrap;color:#bfe9d7"></pre>
        <div style="display:flex;gap:8px">
          <input id="cmd" placeholder="Digite um comando..." autocomplete="off" autocorrect="off" autocapitalize="none"
            style="flex:1;padding:10px;border-radius:12px;border:1px solid var(--stroke);background:transparent;color:inherit">
          <button id="run" class="button">Executar</button>
        </div>`;
      wireTerminal(content);
    }
    if(name==='notes'){
      title.textContent='Notas';
      content.innerHTML = `<textarea style="width:100%;height:60vh;background:#071320;color:#bfe9d7;border:none;padding:12px;border-radius:12px;resize:none"></textarea>`;
    }
    if(name==='settings'){
      title.textContent='Config';
      const isLight = document.documentElement.getAttribute('data-theme')==='light';
      content.innerHTML = `
        <div class="switch"><input id="themeToggle" type="checkbox" ${isLight?'checked':''}><span>Modo Claro</span></div>
        <p class="hint" style="margin-top:8px">Prefer√™ncia salva no navegador.</p>`;
      setTimeout(()=>{
        const tg = content.querySelector('#themeToggle');
        tg.addEventListener('change', e=>{
          const theme = e.target.checked ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem(THEME_KEY, theme);
        });
      },0);
    }
    if(name==='camera'){
      title.textContent='C√¢mera';
      buildCamera(content, win);
    }
  }

  function toggleMaxDesktop(win){
    if(win.dataset.maxed==='1'){
      win.style.width = win.dataset.w; win.style.height = win.dataset.h; win.style.left = win.dataset.l; win.style.top = win.dataset.t; win.dataset.maxed='0';
    } else {
      win.dataset.w = win.style.width; win.style.left='0px'; win.style.top='0px';
      win.dataset.l = '0px'; win.dataset.t = '0px';
      win.style.height = win.dataset.h;
      win.style.width=window.innerWidth+'px'; win.style.height=(window.innerHeight-54)+'px'; win.dataset.maxed='1';
    }
  }

  /* ===== Terminal ===== */
  const fs = {'/':{type:'dir',children:{
    home:{type:'dir',children:{user:{type:'dir',children:{'readme.txt':{type:'file',content:'Bem-vindo ao x1coOS!'}}}}},
    etc:{type:'dir',children:{'motd.txt':{type:'file',content:'Message of the Day'}}}
  }}};
  let cwd = '/home/user';
  function norm(p){
    if(!p) return '/';
    if(p.startsWith('/')){ const parts=p.split('/').filter(Boolean); const out=[]; for(const part of parts){ if(part==='..') out.pop(); else if(part!=='.') out.push(part);} return '/'+out.join('/'); }
    const base=cwd==='/'?[]:cwd.split('/').filter(Boolean);
    const parts=p.split('/').filter(Boolean); const out=base.slice();
    for(const part of parts){ if(part==='..') out.pop(); else if(part!=='.') out.push(part); }
    return '/'+out.join('/');
  }
  function node(p){
    const n=norm(p); if(n==='/') return fs['/'];
    const parts=n.split('/').filter(Boolean); let cur=fs['/'];
    for(const part of parts){ if(!cur.children||!cur.children[part]) return null; cur=cur.children[part]; }
    return cur;
  }
  function lsd(p){
    const n=node(p); if(!n) return {error:'Diret√≥rio n√£o encontrado'};
    if(n.type!=='dir') return {error:'N√£o √© um diret√≥rio'};
    return {children:Object.keys(n.children).map(k=>({name:k,node:n.children[k]}))};
  }
  function wireTerminal(scope){
    const out = scope.querySelector('#out');
    const cmd = scope.querySelector('#cmd');
    const run = scope.querySelector('#run');
    function write(t){ out.textContent += t + '\n'; out.scrollTop = out.scrollHeight; }
    function exec(line){
      const s=(line||'').trim(); if(!s) return; write('> '+s);
      const parts=s.split(' ').filter(Boolean); const c=parts[0]; const rest=parts.slice(1).join(' ');
      if(c==='help') write('help, time, pwd, ls, cd <dir>, echo <txt>, clear, cat <file>');
      else if(c==='time') write(new Date().toString());
      else if(c==='pwd') write(cwd);
      else if(c==='ls'){ const p=norm(rest||'.'); const r=lsd(p); if(r.error) write('Erro: '+r.error); else write(r.children.map(it=>it.node.type==='dir'?it.name+'/':it.name).join('  ')||'(vazio)'); }
      else if(c==='cd'){ const p=norm(rest||'/home/user'); const n=node(p); if(!n) write('cd: n√£o existe'); else if(n.type!=='dir') write('cd: n√£o √© dir'); else { cwd=p; write('ok'); } }
      else if(c==='echo') write(rest);
      else if(c==='clear') out.textContent='';
      else if(c==='cat'){ const p=norm(rest); const n=node(p); if(!n) write('cat: n√£o encontrado'); else if(n.type!=='file') write('cat: n√£o √© arquivo'); else write(n.content||''); }
      else write('Comando n√£o reconhecido.');
    }
    run.addEventListener('click', ()=>{ exec(cmd.value); cmd.value=''; cmd.focus(); });
    cmd.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); exec(cmd.value); cmd.value=''; } });
    setTimeout(()=> cmd && cmd.focus(), 0);
  }

  /* ===== Assistente (parser avan√ßado) ===== */
  function buildAssistant(container){
    container.innerHTML = `
      <div class="chat">
        <div class="chatLog" id="chatLog"></div>
        <div class="chatInput">
          <input id="ask" placeholder="Pergunte: 'quanto √© 15% de 240', 'raiz quadrada de 81', '2x(3+4)'..." autocomplete="off"/>
          <button id="send" class="button">Enviar</button>
        </div>
      </div>`;
    const log = container.querySelector('#chatLog');
    const ask = container.querySelector('#ask');
    const send = container.querySelector('#send');

    function addMsg(text, who='ai'){
      const wrap = document.createElement('div');
      wrap.className = 'msg ' + (who==='me'?'me':'ai');
      const b = document.createElement('div');
      b.className = 'bubble';
      b.textContent = text;
      wrap.appendChild(b);
      log.appendChild(wrap);
      log.scrollTop = log.scrollHeight;
    }
    function n2s(n){ try { return new Intl.NumberFormat('pt-BR', {maximumFractionDigits: 12}).format(n); } catch(e){ return String(n); } }

    function normalize(s){
      return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
    }

    // Quick intents
    function smallTalk(text){
      const norm = normalize(text);
      const h = new Date();
      if(/^(oi|ola|ol[a√°]|e ai|eae|salve|fala|bom dia|boa tarde|boa noite)\b/.test(norm)){
        const hr = h.getHours();
        const sauda = hr<12? 'Bom dia' : (hr<18? 'Boa tarde' : 'Boa noite');
        return `${sauda}! Eu sou o Assistente do x1coOS. Posso fazer contas, porcentagens, ra√≠zes, pot√™ncias e mais.`;
      }
      if(/que horas|qual (?:o|e) horario|que horas sao|horas?\b/.test(norm)){
        return `Agora s√£o ${h.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}.`;
      }
      if(/piada|conte.*piada|me faz rir/.test(norm)){
        const jokes=[
          'Qual √© o lugar mais certo do livro? O √≠ndice, porque est√° sempre no ponto. üòÖ',
          'Por que a matem√°tica √© humilde? Porque sabe que n√£o √© exata para todo mundo.',
          'Passei por 2, 3 e 5 e ningu√©m me cumprimentou‚Ä¶ acho que n√£o sou par!'
        ];
        return jokes[Math.floor(Math.random()*jokes.length)];
      }
      if(/tabuada de\s*(\d+)/.test(norm)){
        const n = parseInt(norm.match(/tabuada de\s*(\d+)/)[1],10);
        let lines=[]; for(let i=0;i<=10;i++){ lines.push(`${n} x ${i} = ${n*i}`); }
        return lines.join('\n');
      }
      return null;
    }

    // Natural language to math expression
    function toExpr(text){
      let s = normalize(text).replace(/,/g,'.');
      // remove leading phrases
      s = s.replace(/\b(quanto e|quanto eh|quanto vale|calcule|resolve|resultado de|qual (?:o|e) resultado de)\b/g, '').trim();

      // percentage "a% de b" -> (a/100)*b
      s = s.replace(/(\d+(?:\.\d+)?)\s*%\s*(?:de\s*)?(\d+(?:\.\d+)?)/g, '($1/100)*($2)');
      // standalone "a%" -> (a/100)
      s = s.replace(/(\d+(?:\.\d+)?)\s*%/g, '($1/100)');

      // words to operators
      s = s.replace(/\b(mais|somado a|adicao de)\b/g, '+');
      s = s.replace(/\b(menos|subtra[i√≠]do de?)\b/g, '-');
      s = s.replace(/\b(vezes|multiplicado por|x)\b/g, '*');
      s = s.replace(/\b(dividido por|sobre)\b/g, '/');
      s = s.replace(/\b(modulo|resto de)\b/g, '%');

      // potencia
      s = s.replace(/\b(elevado a|potencia de|ao quadrado)\b/g, '^2').replace(/\b(ao cubo)\b/g, '^3');
      s = s.replace(/\braiz quadrada de\b/g, 'sqrt(').replace(/\braiz cubica de\b/g, 'cbrt(');
      // close function parens if user didn't
      s = s.replace(/sqrt\(([^)]+)$/g, 'sqrt($1)');
      s = s.replace(/cbrt\(([^)]+)$/g, 'cbrt($1)');

      // implicit multiplication: number)(, )(number, numberfn, )fn
      s = s.replace(/(\d)\s*\(/g, '$1*(');
      s = s.replace(/\)\s*(\d)/g, ')*$1');
      s = s.replace(/(\d)\s*(sqrt|cbrt)\s*\(/g, '$1*$2(');

      // replace constants
      s = s.replace(/\bpi\b/g, String(Math.PI)).replace(/\be\b/g, String(Math.E));

      // Keep only allowed chars
      if(!/^[\d+\-*/^()%.\sA-Za-z]*$/.test(s)) throw new Error('Express√£o inv√°lida.');
      return s;
    }

    // Shunting-yard with ^ (right-assoc), %, functions sqrt/cbrt, unary minus
    function evalExpr(expr){
      if(!expr) throw new Error('Express√£o vazia');
      const tokens=[];
      let i=0;
      while(i<expr.length){
        const ch=expr[i];
        if(ch===' '){ i++; continue; }
        if('+-*/^()%'.includes(ch)){ tokens.push(ch); i++; continue; }
        if(/[0-9.]/.test(ch)){
          let j=i+1; while(j<expr.length && /[0-9.]/.test(expr[j])) j++;
          tokens.push(expr.slice(i,j)); i=j; continue;
        }
        // function names
        if(/[A-Za-z]/.test(ch)){
          let j=i+1; while(j<expr.length && /[A-Za-z]/.test(expr[j])) j++;
          tokens.push(expr.slice(i,j)); i=j; continue;
        }
        throw new Error('Caractere inv√°lido: '+ch);
      }

      // Handle unary minus
      for(let k=0;k<tokens.length;k++){
        if(tokens[k]==='-' && (k===0 || '(-+*/^%'.includes(tokens[k-1]))){
          tokens[k] = 'u-';
        }
      }

      const prec={ 'u-':4, '^':3, '*':2, '/':2, '%':2, '+':1, '-':1 };
      const rightAssoc = {'^':true, 'u-':true};
      const funcs = new Set(['sqrt','cbrt','abs']);

      const out=[], op=[];
      for(let t of tokens){
        if(!isNaN(t)){ out.push(parseFloat(t)); continue; }
        if(funcs.has(t)){ op.push(t); continue; }
        if(t==='u-' || t in prec){
          while(op.length){
            const top=op[op.length-1];
            if((top in prec || funcs.has(top)) &&
              ((rightAssoc[t] && prec[top] > prec[t]) || (!rightAssoc[t] && prec[top] >= prec[t]))){
              out.push(op.pop());
            } else break;
          }
          op.push(t); continue;
        }
        if(t==='('){ op.push(t); continue; }
        if(t===')'){
          while(op.length && op[op.length-1] !== '(') out.push(op.pop());
          if(op.pop()!=='(') throw new Error('Par√™nteses desbalanceados');
          // if function on top, pop it too
          if(op.length && funcs.has(op[op.length-1])) out.push(op.pop());
          continue;
        }
        throw new Error('Token inv√°lido: '+t);
      }
      while(op.length){
        const o=op.pop();
        if(o==='('||o===')') throw new Error('Par√™nteses desbalanceados');
        out.push(o);
      }
      const st=[];
      for(const t of out){
        if(typeof t==='number'){ st.push(t); continue; }
        if(t==='u-'){ const a=st.pop(); st.push(-a); continue; }
        if(t==='sqrt'){ const a=st.pop(); st.push(Math.sqrt(a)); continue; }
        if(t==='cbrt'){ const a=st.pop(); st.push(Math.cbrt(a)); continue; }
        if(t==='abs'){ const a=st.pop(); st.push(Math.abs(a)); continue; }
        const b=st.pop(), a=st.pop(); if(a===undefined||b===undefined) throw new Error('Express√£o inv√°lida');
        switch(t){
          case '+': st.push(a+b); break;
          case '-': st.push(a-b); break;
          case '*': st.push(a*b); break;
          case '/': if(b===0) throw new Error('Divis√£o por zero'); st.push(a/b); break;
          case '%': if(b===0) throw new Error('M√≥dulo por zero'); st.push(a % b); break;
          case '^': st.push(Math.pow(a,b)); break;
          default: throw new Error('Op inv√°lido: '+t);
        }
      }
      if(st.length!==1) throw new Error('Express√£o inv√°lida');
      return st[0];
    }

    function handleMath(text){
      const expr = toExpr(text);
      const val = evalExpr(expr);
      return `Resultado: ${n2s(val)}`;
    }

    function reply(q){
      const quick = smallTalk(q);
      if(quick) return quick;
      try{
        return handleMath(q);
      }catch(e){
        return 'N√£o entendi. Tenta algo como: "15% de 240", "raiz quadrada de 81", "2x(3+4)", "3^4", "10 mod 3", "tabuada de 7".';
      }
    }

    function sendMsg(){
      const val = ask.value;
      if(!val.trim()) return;
      addMsg(val, 'me');
      const r = reply(val);
      addMsg(r, 'ai');
      ask.value='';
      ask.focus();
    }

    send.addEventListener('click', sendMsg);
    ask.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); sendMsg(); } });

    addMsg('Oi! Posso resolver contas com + - √ó √∑, porcentagens, pot√™ncias (^), ra√≠zes (sqrt), m√≥dulo (%), fra√ß√µes e at√© "tabuada de N". Escreve: "quanto √© 15% de 240".');
  }

  /* ===== C√¢mera ===== */
  let camStream=null, useFront=true, devId=null;
  async function listCameras(sel){
    try{
      const devs = await navigator.mediaDevices.enumerateDevices();
      const cams = devs.filter(d=>d.kind==='videoinput');
      sel.innerHTML = cams.map((d,i)=>`<option value="${d.deviceId}">${d.label||'C√¢mera '+(i+1)}</option>`).join('');
      if(cams.length && !devId) devId = cams[0].deviceId;
    }catch(e){ console.warn('enumerateDevices', e); }
  }
  function constraints(){ const v = devId ? {deviceId:{exact:devId}} : {facingMode: useFront?'user':'environment'}; return {audio:false, video:v}; }
  async function camStart(video){
    camStop(video);
    try {
      if(!isSecureContext) throw new Error('insecure');
      const s = await navigator.mediaDevices.getUserMedia(constraints());
      camStream = s; video.srcObject = s; await video.play();
    }catch(err){
      let msg='N√£o consegui acessar a c√¢mera.';
      const n = (err && (err.name||err.message)) || '';
      if(n.includes('NotAllowed')) msg+='\n‚Ä¢ Permiss√£o negada para este site.';
      else if(n.includes('NotReadable')) msg+='\n‚Ä¢ A c√¢mera est√° em uso por outro app.';
      else if(n.includes('NotFound')) msg+='\n‚Ä¢ Nenhuma c√¢mera encontrada.';
      else if(n.includes('insecure')) msg+='\n‚Ä¢ Precisa abrir via HTTPS ou localhost.';
      else msg+='\n‚Ä¢ Erro: '+n;
      alert(msg);
    }
  }
  function camStop(video){ if(camStream){ camStream.getTracks().forEach(t=>t.stop()); camStream=null; } if(video){ video.pause(); video.srcObject=null; } }
  function buildCamera(container, win){
    container.innerHTML = `
      <div id="secureWarn"></div>
      <video id="camView" class="camView" playsinline muted></video>
      <div class="toolbar">
        <button id="bStart" class="button">Iniciar</button>
        <button id="bFlip"  class="button">Trocar</button>
        <select id="bSel" class="button" title="Escolher c√¢mera"></select>
        <button id="bShot"  class="button">Capturar</button>
        <button id="bStop"  class="button">Parar</button>
        <button id="bSave"  class="button" disabled>Salvar foto</button>
        <span class="hint">HTTPS/localhost. No Android, permita a c√¢mera para este site.</span>
      </div>
      <img id="photo" class="preview" alt="Foto"/>
      <canvas id="canvas" style="display:none"></canvas>`;
    setTimeout(async()=>{
      const cam = container.querySelector('#camView');
      const bStart=container.querySelector('#bStart');
      const bFlip=container.querySelector('#bFlip');
      const bSel=container.querySelector('#bSel');
      const bShot=container.querySelector('#bShot');
      const bStop=container.querySelector('#bStop');
      const bSave=container.querySelector('#bSave');
      const cv=container.querySelector('#canvas');
      const photo=container.querySelector('#photo');
      if(!isSecureContext){
        const w = container.querySelector('#secureWarn');
        w.innerHTML = '<div class="hint">Contexto n√£o seguro. Use HTTPS ou localhost.</div>';
      }
      await listCameras(bSel);
      bSel.addEventListener('change', ()=>{ devId=bSel.value||null; });
      bStart.addEventListener('click', async ()=>{
        await camStart(cam);
        await listCameras(bSel);
        if(camStream){
          const track = camStream.getVideoTracks()[0];
          const set = track.getSettings();
          if(set && set.deviceId){
            devId = set.deviceId;
            const opt=[...bSel.options].find(o=>o.value===devId); if(opt) bSel.value=devId;
          }
        }
      });
      bFlip.addEventListener('click', async ()=>{
        if(!devId){ useFront=!useFront; if(camStream) await camStart(cam); }
        else {
          if(bSel.options.length>1){
            const i=bSel.selectedIndex, n=(i+1)%bSel.options.length;
            bSel.selectedIndex=n; devId=bSel.value; if(camStream) await camStart(cam);
          }
        }
      });
      bStop.addEventListener('click', ()=> camStop(cam));
      bShot.addEventListener('click', ()=>{
        if(!cam.videoWidth) return;
        cv.width=cam.videoWidth; cv.height=cam.videoHeight;
        cv.getContext('2d').drawImage(cam,0,0,cv.width,cv.height);
        photo.src = cv.toDataURL('image/png');
        photo.style.display='block';
        bSave.disabled = false;
        const flash=document.createElement('div');
        flash.style.position='fixed';flash.style.inset='0';flash.style.background='#fff';flash.style.opacity='0.9';flash.style.transition='opacity .25s';flash.style.zIndex='1000';
        document.body.appendChild(flash);
        setTimeout(()=>{flash.style.opacity='0'; setTimeout(()=>flash.remove(), 220)}, 80);
      });
      bSave.addEventListener('click', ()=>{
        if(!photo.src) return;
        const a=document.createElement('a');
        a.href=photo.src; a.download='foto-x1coOS-'+new Date().toISOString().replace(/[:.]/g,'-')+'.png';
        document.body.appendChild(a); a.click(); a.remove();
      });
      win.querySelector('[data-act="close"]').addEventListener('click', ()=> camStop(cam));
    },0);
  }

  // Start & icons
  btnStart.addEventListener('click', e=>{ startMenu.classList.toggle('visible'); e.stopPropagation(); });
  document.addEventListener('click', e=>{ if(!startMenu.contains(e.target) && e.target!==btnStart) startMenu.classList.remove('visible'); });
  startMenu.querySelectorAll('button[data-app]').forEach(b=> b.addEventListener('click', ()=> openApp(b.getAttribute('data-app')) ));
  iconGrid.addEventListener('click', e=>{ const card = e.target.closest('.appIcon'); if(!card) return; openApp(card.getAttribute('data-app')); }, {passive:true});

  bBack.addEventListener('click', ()=>{
    const wins=[...document.querySelectorAll('.window')];
    const w = wins[wins.length-1]; if(!w) return;
    const tid = w.dataset.id; w.remove(); rmTask(tid);
    if(isMobile() && document.querySelectorAll('.window').length===0){
      systemBar.classList.remove('visible');
      taskbar.classList.remove('hideOnMobile');
    }
  });
  bHome.addEventListener('click', ()=>{
    document.querySelectorAll('.window').forEach(w=>w.remove());
    tasks.innerHTML='';
    systemBar.classList.remove('visible');
    taskbar.classList.remove('hideOnMobile');
  });
  bRecents.addEventListener('click', ()=>{
    startMenu.classList.toggle('visible');
  });
});
</script>

<style id="x1coos-layout-v6">
  :root{ --topbar-h: 48px; --gap: 8px; --sys-h: 64px; }
  /* Top clock bar */
  #topClockBar{
    position: fixed; top:0; left:0; right:0;
    height: var(--topbar-h);
    display:flex; align-items:center; justify-content:flex-end; gap:12px;
    padding: 0 12px;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
    color:#e6eef8; font: 14px/1 system-ui, Segoe UI, Roboto, Arial;
    z-index: 99998;
    border-bottom: 1px solid rgba(255,255,255,.08);
    pointer-events: none; /* n√£o bloqueia clique dos apps */
  }
  #topClockBar .clock{ font-weight:600; letter-spacing:.2px; }

  /* Reserva espa√ßo global */
  html, body{ scroll-padding-top: calc(var(--topbar-h) + var(--gap) + env(safe-area-inset-top,0px)); }
  #desktop{
    padding-top: calc(var(--topbar-h) + var(--gap) + env(safe-area-inset-top,0px)) !important;
    padding-bottom: calc(var(--sys-h) + env(safe-area-inset-bottom,0px)) !important;
  }
  /* Alguns temas usam margin em vez de padding no grid */
  #iconGrid{ margin-top: var(--gap); }

  /* Barra de navega√ß√£o sempre vis√≠vel */
  #systemBar{ display:flex !important; z-index:99999 !important; }

  /* Oculta taskbar e start/hamburger */
  #taskbar{ display:none !important; }
  #startBtn, .startBtn, [data-action="openStart"], [data-role="start"], #startMenuToggle{ display:none !important; }

  /* Embeds ocupam 100% da √°rea da janela */
  .content.content-embed{ padding:0 !important; }
  .content.content-embed > iframe{ width:100% !important; height:100% !important; display:block; border:0; }

  /* Limites para janelas: nunca sob o topbar, nem al√©m do rodap√© */
  .window{
    max-height: calc(100dvh - var(--topbar-h) - var(--gap) - var(--sys-h) - 8px);
  }
  .window.mobile-full{
    top: var(--topbar-h) !important;
    left: 0 !important;
    width: 100vw !important;
    height: calc(100dvh - var(--topbar-h)) !important;
  }
  @media (max-width: 900px){
    .window.mobile-full .content.content-embed.embed-with-systembar{
      padding-bottom: calc(var(--sys-h) + env(safe-area-inset-bottom, 0px)) !important;
    }
  }
</style>
<script>
// x1coOS: runtime layout fix v6 (reserve top area + clamp windows) + snake icon/branch
(function(){
  function qs(s){ return document.querySelector(s); }
  function qsa(s){ return Array.from(document.querySelectorAll(s)); }
  function insertAfter(n, ref){ ref.parentNode.insertBefore(n, ref.nextSibling); }
  function isMobile(){ return matchMedia('(max-width: 900px)').matches; }
  function topH(){ 
    var cs = getComputedStyle(document.documentElement);
    var v = cs.getPropertyValue('--topbar-h').trim() || '48px';
    return parseInt(v,10) || 48;
  }
  function sysH(){
    var cs = getComputedStyle(document.documentElement);
    var v = cs.getPropertyValue('--sys-h').trim() || '64px';
    return parseInt(v,10) || 64;
  }

  // Top clock
  function createTopClock(){
    if(qs('#topClockBar')) return;
    const bar = document.createElement('div'); bar.id='topClockBar';
    const span = document.createElement('span'); span.className='clock'; bar.appendChild(span);
    document.body.appendChild(bar);
    const pad=n=>n<10?'0'+n:n;
    function tick(){ const d=new Date(); span.textContent = pad(d.getHours())+':'+pad(d.getMinutes()); }
    tick(); setInterval(tick, 30*1000);
  }

  // Remove Start + taskbar; keep systemBar visible
  function setupBars(){
    qsa('#startBtn, .startBtn, [data-action="openStart"], [data-role="start"], #startMenuToggle').forEach(el=> el.style.display='none');
    const startMenu = qs('#startMenu'); if(startMenu) startMenu.style.display='none';
    const taskbar = qs('#taskbar'); if(taskbar) taskbar.style.display='none';
    const sys = qs('#systemBar'); if(sys){ sys.classList.add('visible'); sys.style.display='flex'; sys.style.zIndex='99999'; }
  }

  // Clamp any window away from the top bar and bottom nav
  function clampWindows(){
    const th = topH();
    const sh = sysH();
    qsa('.window').forEach(w => {
      const topVal = parseInt(w.style.top||'0',10);
      if(!isNaN(topVal) && topVal < th + 4){
        w.style.top = (th + 8) + 'px';
      }
      // ensure height fits
      const vh = Math.max(window.innerHeight, document.documentElement.clientHeight);
      const maxH = vh - th - sh - 12; // small gap
      const curH = parseInt(w.style.height||'0',10);
      if(!isNaN(curH) && curH > maxH){
        w.style.height = maxH + 'px';
      }
    });
  }

  // Observe new windows and clamp them immediately
  function observeWindows(){
    const desk = qs('#desktop'); if(!desk) return;
    const mo = new MutationObserver(() => clampWindows());
    mo.observe(desk, { childList:true, subtree:true });
    window.addEventListener('resize', clampWindows);
  }

  // Snake icon just after Camera
  function ensureSnakeIcon(){
    try{
      var grid = qs('#iconGrid');
      var cam = grid && grid.querySelector('.appIcon[data-app="camera"]');
      if(!grid || !cam) return;
      if(grid.querySelector('.appIcon[data-app="snake"]')) return;
      var card = document.createElement('div');
      card.className = 'appIcon';
      card.setAttribute('data-app','snake');
      card.setAttribute('role','button'); card.setAttribute('tabindex','0'); card.setAttribute('aria-label','Cobrinha');
      card.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">\
        <path d="M4 12c0-3.314 2.686-6 6-6h4a3 3 0 013 3v1a2 2 0 002 2h1a2 2 0 110 4h-5a3 3 0 00-3 3v1a2 2 0 11-4 0v-1a5 5 0 015-5h6" opacity=".7"/>\
        <circle cx="9" cy="8" r="0.8" fill="currentColor"/></svg>\
        <div class="label">Cobrinha</div>';
      insertAfter(card, cam);
      function openSnake(){ try{ window.openApp ? window.openApp('snake') : console.warn('openApp indispon√≠vel'); }catch(e){} }
      card.addEventListener('click', openSnake);
      card.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); openSnake(); }});
    }catch(e){ console.warn('Snake icon patch error', e); }
  }

  // Snake window creation
  function createSnakeWindow(){
    var desk = document.getElementById('desktop');
    var tpl = document.getElementById('winTpl');
    var w = tpl.content.cloneNode(true).querySelector('.window');
    w.dataset.id = 'w_snake_'+Date.now();
    var content = w.querySelector('.content');
    w.querySelector('.title').textContent = 'Cobrinha';
    content.classList.add('content-embed');
    if(isMobile()) content.classList.add('embed-with-systembar');
    content.innerHTML = '<iframe src="snake.html" title="Cobrinha" allowfullscreen></iframe>';

    // Initial placement before clamping
    const th = topH(), sh = sysH();
    if(isMobile()){
      w.classList.add('mobile-full');
      w.style.top = th + 'px';
      w.style.left = '0px';
      w.style.width = '100vw';
      w.style.height = 'calc(100dvh - var(--topbar-h))';
    } else {
      const ww = Math.min(960, Math.max(600, Math.floor(window.innerWidth*0.88)));
      const wh = Math.min(720, Math.max(420, Math.floor(window.innerHeight*0.86)));
      w.style.left = Math.max(12, Math.floor((window.innerWidth - ww)/2))+'px';
      w.style.top  = Math.max(th + 8, Math.floor((window.innerHeight - wh)/2))+'px';
      w.style.width = ww+'px';
      w.style.height = wh+'px';
    }

    desk.appendChild(w);
    w.style.zIndex = 9999;
    clampWindows();

    // Wire close
    const btnClose = w.querySelector('[data-act="close"]');
    if(btnClose){ btnClose.addEventListener('click', ()=>{ w.remove(); }); }
  }

  function ensureSnakeBranch(){
    if(window.__snakeBranchPatched) return;
    window.__snakeBranchPatched = true;
    var orig = window.openApp;
    if(typeof orig === 'function'){
      window.openApp = function(name){
        if(name==='snake'){ createSnakeWindow(); return; }
        return orig.apply(this, arguments);
      };
    } else {
      window.openApp = function(name){ if(name==='snake') createSnakeWindow(); };
    }
  }

  function boot(){
    createTopClock();
    setupBars();
    observeWindows();
    ensureSnakeIcon();
    ensureSnakeBranch();
    clampWindows();
  }

  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', boot);
  else boot();
})();
</script>



<!-- x1coOS: TicTacToe app (vs AI & 2P) -->
<script id="tictactoe-app">
(function(){
  function qs(s){ return document.querySelector(s); }
  function insertAfter(n, ref){ ref.parentNode.insertBefore(n, ref.nextSibling); }
  function isMobile(){ return matchMedia('(max-width: 900px)').matches; }
  function topH(){ 
    var cs = getComputedStyle(document.documentElement);
    var v = cs.getPropertyValue('--topbar-h').trim() || '48px';
    return parseFloat(v) || 48;
  }
  function sysH(){
    var cs = getComputedStyle(document.documentElement);
    var v = cs.getPropertyValue('--sys-h').trim() || '64px';
    return parseFloat(v) || 64;
  }
  function ensureTicIcon(){
    var grid = qs('#desktop .grid') || qs('#desktop');
    if(!grid) return;
    var cam = grid.querySelector('.appIcon[data-app="camera"]');
    if(!cam) return;
    if(grid.querySelector('.appIcon[data-app="tictactoe"]')) return;

    var card = document.createElement('div');
    card.className = 'appIcon';
    card.setAttribute('data-app', 'tictactoe');
    card.setAttribute('role','button'); card.setAttribute('tabindex','0'); card.setAttribute('aria-label','Jogo da Velha');
    card.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">\
      <path d="M8 3v18M16 3v18M3 8h18M3 16h18" />\
      <path d="M5.5 5.5l4 4M9.5 5.5l-4 4" stroke-width="1.4"/>\
      <circle cx="18.5" cy="5.5" r="2" />\
    </svg>\
    <div class="label">Jogo da Velha</div>';
    insertAfter(card, cam);
    function openTic(){ try{ window.openApp ? window.openApp('tictactoe') : console.warn('openApp indispon√≠vel'); }catch(e){} }
    card.addEventListener('click', openTic);
    card.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); openTic(); } });
  }

  function createTicWindow(){
    var tpl = qs('#winTpl');
    var desk = qs('#desktop');
    if(!tpl || !desk) return;
    var w = tpl.content.cloneNode(true).querySelector('.window');
    w.dataset.id = 'w_tic_'+Date.now();
    var content = w.querySelector('.content');
    w.querySelector('.title').textContent = 'Jogo da Velha';
    content.classList.add('content-embed');
    if(isMobile()) content.classList.add('embed-with-systembar');
    content.innerHTML = '<iframe src="tictactoe_ai.html" title="Jogo da Velha" allowfullscreen></iframe>';

    if(isMobile()){
      w.classList.add('mobile-full');
      w.style.top = topH() + 'px';
      w.style.left = '0px';
      w.style.width = '100vw';
      w.style.height = 'calc(100dvh - var(--topbar-h))';
    }else{
      w.style.left = (60+Math.random()*180)+'px';
      w.style.top = (60+Math.random()*120)+'px';
    }
    desk.appendChild(w);
    // Foca usando API j√° existente se tiver
    try{ window.focusWin && window.focusWin(w.dataset.id); }catch(e){}
  }

  function ensureTicBranch(){
    var orig = window.openApp;
    if(typeof orig === 'function'){
      window.openApp = function(name){
        if(name==='tictactoe'){ createTicWindow(); return; }
        return orig.apply(this, arguments);
      };
    }else{
      window.openApp = function(name){ if(name==='tictactoe') createTicWindow(); };
    }
  }

  function boot(){
    ensureTicIcon();
    ensureTicBranch();
  }
  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', boot);
  else boot();
})();
</script>
<!-- x1coOS: YouTube app (v3) -->
<style id="ytapp-v3-css">
  .appIcon[data-app="youtube"]{ pointer-events:auto !important; }
  .appIcon[data-app="youtube"] .label{ white-space:nowrap; }
  /* ensure icon svg scales like others */
  .appIcon[data-app="youtube"] svg{ width:56px; height:56px; display:block; margin:0 auto; }
</style>
<script id="ytapp-v3-js">
(function(){
  function qs(s){ return document.querySelector(s); }
  function qsa(s){ return Array.from(document.querySelectorAll(s)); }
  function makeIconLike(base){
    // tries to mimic the DOM structure of an existing appIcon
    var el = document.createElement('div');
    el.className = base ? base.className : 'appIcon';
    el.setAttribute('data-app','youtube');
    el.setAttribute('role','button');
    el.setAttribute('tabindex','0');

    // Build icon content
    var svg = '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">'
            + '  <rect x="2" y="5" width="20" height="14" rx="4" ry="4" opacity=".9"></rect>'
            + '  <polygon points="10,8 16,12 10,16" fill="#ffffff"></polygon>'
            + '</svg>';
    var label = '<div class="label">YouTube</div>';

    // If base has an inner wrapper for the icon, replicate
    var wrapClass = '';
    if(base){
      var w = base.querySelector('.iconWrap') || base.querySelector('.icon') || null;
      if(w){ wrapClass = w.className; }
    }
    if(wrapClass){
      el.innerHTML = '<div class="'+wrapClass+'">'+svg+'</div>'+label;
    }else{
      el.innerHTML = svg + label;
    }
    return el;
  }

  function insertDesktopIcon(){
    var grid = qs('#iconGrid');
    if(!grid) return null;
    // avoid duplicates
    var existing = grid.querySelector('.appIcon[data-app="youtube"]');
    if(existing) return existing;

    var base = grid.querySelector('.appIcon[data-app="assistant"]') || grid.querySelector('.appIcon');
    var icon = makeIconLike(base);

    // Insert right after camera if present, else at the end
    var cam = grid.querySelector('.appIcon[data-app="camera"]');
    if(cam && cam.parentNode === grid) cam.insertAdjacentElement('afterend', icon);
    else grid.appendChild(icon);
    return icon;
  }

  function insertMenuIcon(){
    // Try to add to a start/app list if present
    var list = qs('#startMenu .appList, #appList, #menuApps, #start-apps');
    if(!list) return null;
    if(list.querySelector('.appIcon[data-app="youtube"]')) return null;
    var base = list.querySelector('.appIcon') || qs('#iconGrid .appIcon');
    var icon = makeIconLike(base);
    list.appendChild(icon);
    return icon;
  }

  function openInside(){
    var url = 'ythub.html?v=' + Date.now();
    if(window.__openOverlayURL){ window.__openOverlayURL(url); return; }
    if(typeof window.openApp === 'function'){
      try{ return window.openApp('youtube:internal'); }catch(e){}
    }
    // Ultimate fallback: simple overlay
    var ov = document.getElementById('appOverlay');
    if(!ov){
      ov = document.createElement('div'); ov.id='appOverlay';
      ov.style.cssText='position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.65);z-index:99998;';
      var inner = document.createElement('div'); inner.className='inner'; inner.style.cssText='position:absolute;left:0;top:0;right:0;bottom:0;';
      var btn = document.createElement('button'); btn.textContent='Fechar'; btn.style.cssText='position:absolute;top:10px;right:12px;z-index:2';
      btn.onclick=function(){ ov.remove(); };
      var ifr = document.createElement('iframe'); ifr.src=url; ifr.allowFullscreen=true;
      ifr.style.cssText='position:absolute;left:0;top:0;right:0;bottom:0;width:100%;height:100%;border:0;';
      inner.appendChild(ifr); ov.appendChild(inner); ov.appendChild(btn); document.body.appendChild(ov);
    } else {
      // reuse existing overlay if your OS uses this id
      var inner = ov.querySelector('.inner'); if(inner){ inner.innerHTML=''; var ifr=document.createElement('iframe'); ifr.src=url; ifr.allowFullscreen=true; ifr.style.cssText='position:absolute;left:0;top:0;right:0;bottom:0;width:100%;height:100%;border:0;'; inner.appendChild(ifr); }
      ov.style.display='block';
    }
  }

  // Hook into the system app launcher if it exists
  (function hookOpenApp(){
    if(typeof window.openApp !== 'function'){
      // defer and try again after DOM ready
      document.addEventListener('readystatechange', function once(){
        if(document.readyState === 'complete'){
          if(typeof window.openApp === 'function'){
            document.removeEventListener('readystatechange', once);
            hookOpenApp();
          }
        }
      });
      return;
    }
    var orig = window.openApp;
    if(orig.__ytHooked) return;
    window.openApp = function(name){
      if(name === 'youtube' || (typeof name === 'string' && name.startsWith('youtube:'))){
        openInside(); return;
      }
      return orig.apply(this, arguments);
    };
    window.openApp.__ytHooked = true;
  })();

  function wire(el){
    if(!el) return;
    el.addEventListener('click', openInside, {passive:true});
    el.addEventListener('keydown', function(e){ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); openInside(); } });
    // Safety: ensure it's not overlapped/inert
    el.style.pointerEvents='auto'; el.style.zIndex='2';
  }

  function boot(){
    wire(insertDesktopIcon());
    wire(insertMenuIcon());
  }
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', boot);
  else boot();
})();
</script>


<!-- x1coOS nav fix v4 (merged) -->
<style id="nav-fix-v4">
  :root{ --sys-h: 64px; }
  #systemBar{
    position: fixed !important;
    left: 0; right: 0; bottom: 0;
    z-index: 2147483647 !important;
    pointer-events: auto !important;
  }
  #appOverlay, .x1co-overlay, .overlay-app, .app-overlay {
    position: fixed;
    left:0; right:0; top:0; 
    bottom: var(--sys-h) !important;
    z-index: 2147483600 !important;
  }
  #appOverlay iframe, .x1co-overlay iframe, .overlay-app iframe, .app-overlay iframe {
    position:absolute; left:0; top:0; right:0; bottom:0;
    width:100%; height:100%; border:0;
  }
</style>
<script id="nav-fix-v4-js">
(function(){
  function qs(s){ return document.querySelector(s); }
  function reserveNavSpace(ov){
    if(!ov) return;
    ov.style.bottom = 'var(--sys-h)';
    ov.style.zIndex = '2147483600';
  }
  function findOverlay(){
    return qs('#appOverlay') || qs('.x1co-overlay') || qs('.overlay-app') || qs('.app-overlay');
  }
  reserveNavSpace(findOverlay());
  new MutationObserver(function(){ const ov = findOverlay(); if(ov) reserveNavSpace(ov); })
    .observe(document.body, {childList:true, subtree:true});
  (function hookOpen(){
    var fn = window.__openOverlayURL;
    if(typeof fn !== 'function' || fn.__navFixHooked) return;
    window.__openOverlayURL = function(url){
      try { history.pushState({x1coOverlay:true}, '', location.href); } catch(e){}
      const ret = fn.apply(this, arguments);
      setTimeout(function(){ reserveNavSpace(findOverlay()); }, 50);
      return ret;
    };
    window.__openOverlayURL.__navFixHooked = true;
  })();
  window.addEventListener('popstate', function(){
    const ov = findOverlay();
    if(ov && ov.parentNode){
      ov.parentNode.removeChild(ov);
      try { history.pushState(null, '', location.href); } catch(e){}
    }
  });
  const nav = qs('#systemBar');
  if(nav){ nav.style.zIndex = '2147483647'; nav.style.pointerEvents = 'auto'; }
})();
</script>


<!-- x1coOS nav fix v5 (strong) -->
<style id="nav-fix-v5">
  :root{ --sys-h: 64px; }

  /* 1) Garante que a barra de navega√ß√£o fique SEMPRE por cima e clic√°vel */
  #systemBar, #navBar, #bottomBar, #systemNavigation {
    position: fixed !important;
    left: 0; right: 0; bottom: 0;
    z-index: 2147483647 !important;
    pointer-events: auto !important;
  }

  /* 2) Qualquer overlay padr√£o passa a TER altura limitada (n√£o cobre a nav) */
  #appOverlay, .x1co-overlay, .overlay-app, .app-overlay, #overlay, #overlayRoot {
    position: fixed !important;
    left: 0 !important; right: 0 !important; top: 0 !important;
    height: calc(100dvh - var(--sys-h)) !important;
    bottom: auto !important;
    z-index: 2147483600 !important;
  }

  /* 3) Containers internos tamb√©m respeitam a √°rea √∫til */
  #appOverlay .inner, .x1co-overlay .inner, .overlay-app .inner, .app-overlay .inner, #overlay .inner, #overlayRoot .inner {
    position: absolute !important;
    left: 0; top: 0; right: 0; bottom: 0;
  }

  /* 4) Iframes/embeds dentro do overlay ocupam 100% da √°rea √∫til (sem cobrir nav) */
  #appOverlay iframe, .x1co-overlay iframe, .overlay-app iframe, .app-overlay iframe, 
  #overlay iframe, #overlayRoot iframe {
    position: absolute !important;
    left: 0; top: 0; right: 0; bottom: 0;
    width: 100% !important; height: 100% !important; border: 0 !important;
    pointer-events: auto !important; /* o player continua clic√°vel */
  }

  /* 5) Evita overlays invis√≠veis bloqueando cliques na nav */
  .nav-guard { pointer-events: none !important; }

  /* 6) Seguran√ßa extra: qualquer elemento full-screen que fique por cima perde a parte de baixo */
  .window.fullscreen, .window.mobile-full, .window.maximized {
    bottom: var(--sys-h) !important;
  }
</style>

<script id="nav-fix-v5-js">
(function(){
  function qs(s){ return document.querySelector(s); }
  function qsa(s){ return Array.from(document.querySelectorAll(s)); }

  var NAV_SEL = '#systemBar, #navBar, #bottomBar, #systemNavigation';
  var OV_SEL  = '#appOverlay, .x1co-overlay, .overlay-app, .app-overlay, #overlay, #overlayRoot';

  function ensureNav(){
    qsa(NAV_SEL).forEach(function(nav){
      nav.style.position = 'fixed';
      nav.style.left = '0'; nav.style.right = '0'; nav.style.bottom = '0';
      nav.style.zIndex = '2147483647';
      nav.style.pointerEvents = 'auto';
    });
  }

  function fixOverlayBox(ov){
    if(!ov) return;
    ov.style.position = 'fixed';
    ov.style.left = '0'; ov.style.right = '0'; ov.style.top = '0';
    ov.style.height = 'calc(100dvh - var(--sys-h))';
    ov.style.bottom = 'auto';
    ov.style.zIndex = '2147483600';
    var inner = ov.querySelector('.inner');
    if(inner){
      inner.style.position = 'absolute';
      inner.style.left = '0'; inner.style.top = '0'; inner.style.right = '0'; inner.style.bottom = '0';
    }
    qsa('iframe', ov).forEach(function(ifr){
      ifr.style.position = 'absolute';
      ifr.style.left = '0'; ifr.style.top = '0'; ifr.style.right = '0'; ifr.style.bottom = '0';
      ifr.style.width = '100%'; ifr.style.height = '100%'; ifr.style.border = '0';
      ifr.style.pointerEvents = 'auto';
    });
  }

  function fixAnyOverlay(){
    qsa(OV_SEL).forEach(fixOverlayBox);
  }

  // 1) Ajusta imediatamente
  ensureNav();
  fixAnyOverlay();

  // 2) Observa o DOM para overlays que aparecem depois
  new MutationObserver(function(){
    ensureNav();
    fixAnyOverlay();
  }).observe(document.documentElement, {childList: true, subtree: true});

  // 3) Se o sistema tiver __openOverlayURL, enganchamos para ajustar logo ap√≥s abrir
  (function hookOpen(){
    var fn = window.__openOverlayURL;
    if(typeof fn !== 'function' || fn.__navFixHookedV5) return;
    window.__openOverlayURL = function(url){
      try { history.pushState({x1coOverlay:true}, '', location.href); } catch(e){}
      var ret = fn.apply(this, arguments);
      setTimeout(fixAnyOverlay, 30);
      return ret;
    };
    window.__openOverlayURL.__navFixHookedV5 = true;
  })();

  // 4) Bot√£o voltar fecha overlay (caso tenha sido aberto por n√≥s)
  window.addEventListener('popstate', function(){
    var ov = qs(OV_SEL);
    if(ov && ov.parentNode){
      ov.parentNode.removeChild(ov);
      try { history.pushState(null, '', location.href); } catch(e){}
    }
  });
})();
</script>


<!-- x1coOS nav fix v6: hook navbar buttons to close overlay -->
<script id="nav-fix-v6-js">
(function(){
  var NAV_SEL = '#systemBar, #navBar, #bottomBar, #systemNavigation';
  var OV_SEL  = '#appOverlay, .x1co-overlay, .overlay-app, .app-overlay, #overlay, #overlayRoot';
  function qs(s){ return document.querySelector(s); }
  function getOverlay(){ return qs(OV_SEL); }
  function closeOverlay(){
    var ov = getOverlay();
    if(ov && ov.parentNode){
      ov.parentNode.removeChild(ov);
      try { history.pushState(null, '', location.href); } catch(e){}
      return true;
    }
    return false;
  }
  function isNavAction(el){
    if(!el) return false;
    var txt = (el.getAttribute('data-action')||'').toLowerCase();
    if(txt) return /home|inicio|in√≠cio|back|voltar|recent|overview/.test(txt);
    var title = (el.getAttribute('title')||'').toLowerCase();
    if(title && /home|in[i√≠]cio|voltar|back|recentes|overview/.test(title)) return true;
    var aria = (el.getAttribute('aria-label')||'').toLowerCase();
    if(aria && /home|in[i√≠]cio|voltar|back|recentes|overview/.test(aria)) return true;
    // fallback: if it's a button inside navbar, consider it actionable
    if(el.tagName === 'BUTTON') return true;
    return false;
  }
  function delegateNav(ev){
    var nav = ev.currentTarget;
    var t = ev.target.closest('button, [role="button"], [data-action], [aria-label]');
    if(!t) return;
    if(!isNavAction(t)) return;
    // if an overlay is open, consume and close it
    if(getOverlay()){
      ev.preventDefault();
      ev.stopPropagation();
      closeOverlay();
    }
  }
  // attach once
  document.querySelectorAll(NAV_SEL).forEach(function(nav){
    nav.addEventListener('click', delegateNav, true);   // capture to beat other handlers
    nav.addEventListener('touchstart', delegateNav, true);
  });
})();
</script>


<!-- x1coOS nav fix v7: single-click Home/Back closes overlay and navigates -->
<script id="nav-fix-v7-js">
(function(){
  var NAV_SEL = '#systemBar, #navBar, #bottomBar, #systemNavigation';
  var OV_SEL  = '#appOverlay, .x1co-overlay, .overlay-app, .app-overlay, #overlay, #overlayRoot';
  function qs(s){ return document.querySelector(s); }
  function qsa(s){ return Array.from(document.querySelectorAll(s)); }
  function getOverlay(){ return qs(OV_SEL); }

  // Track overlay state to avoid double push/pop
  window.__x1coOverlayOpen = window.__x1coOverlayOpen || false;

  // Hook __openOverlayURL once: pushState only the first time
  (function hookOpen(){
    var fn = window.__openOverlayURL;
    if(typeof fn !== 'function' || fn.__navV7Hooked) return;
    window.__openOverlayURL = function(url){
      if(!window.__x1coOverlayOpen){
        try { history.pushState({x1coOverlay:true}, '', location.href); } catch(e){}
      }
      window.__x1coOverlayOpen = true;
      return fn.apply(this, arguments);
    };
    window.__openOverlayURL.__navV7Hooked = true;
  })();

  function closeOverlay(){
    var ov = getOverlay();
    if(ov && ov.parentNode){
      ov.parentNode.removeChild(ov);
    }
    if(window.__x1coOverlayOpen){
      window.__x1coOverlayOpen = false;
      // Consume our dummy history state if present
      try {
        if(history.state && history.state.x1coOverlay){ history.back(); }
      } catch(e){}
      return true;
    }
    return !!ov;
  }

  // Prefer not to block default nav behavior: close overlay asynchronously
  function onNavClick(ev){
    // If an overlay is present, schedule close and let the nav button do its default action
    if(getOverlay()){
      setTimeout(closeOverlay, 0);
      // DO NOT preventDefault: we want Home/Back to act immediately in the same click
    }
  }

  // Attach capturing listener to beat other handlers but not block default
  qsa(NAV_SEL).forEach(function(nav){
    nav.addEventListener('click', onNavClick, true);
    nav.addEventListener('touchstart', onNavClick, true);
  });

  // If user presses Android Back (hardware/gesture), close overlay first
  window.addEventListener('popstate', function(){
    // If our marker is present, ensure overlay is closed
    if(history.state && history.state.x1coOverlay){
      // Overlay should already be closed via history.back(); ensure flag is reset
      window.__x1coOverlayOpen = false;
    }
  });
})();
</script>


<!-- x1coOS nav fix v8 ‚Äî fecha overlay e re-dispacha o clique (1 toque s√≥) -->
<style>
  :root{ --sys-h:64px; }
  /* Nav sempre por cima e clic√°vel */
  #systemBar, #navBar, #bottomBar, #systemNavigation{
    position:fixed !important; left:0; right:0; bottom:0;
    z-index:2147483647 !important; pointer-events:auto !important;
  }
  /* Overlays n√£o cobrem a nav */
  #appOverlay, .x1co-overlay, .overlay-app, .app-overlay, #overlay, #overlayRoot{
    position:fixed !important; left:0 !important; right:0 !important; top:0 !important;
    height:calc(100dvh - var(--sys-h)) !important; bottom:auto !important;
    z-index:2147483600 !important;
  }
  /* Iframes internos ocupam a √°rea √∫til */
  #appOverlay iframe, .x1co-overlay iframe, .overlay-app iframe, .app-overlay iframe,
  #overlay iframe, #overlayRoot iframe{
    position:absolute !important; inset:0 !important; width:100% !important; height:100% !important; border:0 !important;
  }
</style>
<script>
(function(){
  const NAV_SEL = '#systemBar, #navBar, #bottomBar, #systemNavigation';
  const OV_SEL  = '#appOverlay, .x1co-overlay, .overlay-app, .app-overlay, #overlay, #overlayRoot';

  const qs  = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
  const getOverlay = () => qs(OV_SEL);

  function closeOverlaySync(){
    const ov = getOverlay();
    if(ov && ov.parentNode){ ov.parentNode.removeChild(ov); return true; }
    return false;
  }

  function handler(ev){
    const target = ev.target.closest('button, [role="button"], [data-action], [aria-label], a');
    if(!target) return;
    if(!getOverlay()) return;

    ev.preventDefault();
    ev.stopPropagation();

    closeOverlaySync();

    setTimeout(()=>{
      try{ target.click(); }
      catch(e){
        const evt = new MouseEvent('click', {bubbles:true, cancelable:true, view:window});
        target.dispatchEvent(evt);
      }
    }, 0);
  }

  qsa(NAV_SEL).forEach(nav=>{
    nav.addEventListener('click', handler, true);
    nav.addEventListener('touchstart', handler, true);
  });
})();
</script>


<!-- x1coOS nav fix v9 ‚Äî fecha overlay SINCRONO em fase de captura e deixa o clique seguir -->
<script>
(function(){
  const NAV_SEL = '#systemBar, #navBar, #bottomBar, #systemNavigation';
  const OV_SEL  = '#appOverlay, .x1co-overlay, .overlay-app, .app-overlay, #overlay, #overlayRoot';
  const qs  = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
  const getOverlay = () => qs(OV_SEL);

  function closeOverlaySync(){
    const ov = getOverlay();
    if(ov && ov.parentNode){ ov.parentNode.removeChild(ov); return true; }
    return false;
  }

  // Captura o evento ANTES de chegar ao bot√£o: remove overlay e N√ÉO cancela o evento
  function captureHandler(ev){
    if(!getOverlay()) return;
    // remover overlay sincrono agora
    closeOverlaySync();
    // n√£o chamamos preventDefault/stopPropagation
    // o mesmo evento seguir√° at√© o alvo (Home/Voltar) j√° sem overlay interferindo
  }

  qsa(NAV_SEL).forEach(nav=>{
    nav.addEventListener('click', captureHandler, true);
    nav.addEventListener('touchstart', captureHandler, true);
    nav.addEventListener('pointerdown', captureHandler, true);
  });
})();
</script>

</body>
</html>
